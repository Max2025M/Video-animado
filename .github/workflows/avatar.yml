name: Generate Avatar

on:
  workflow_dispatch:
    inputs:
      image_b64:
        description: 'Base64 da imagem'
        required: true
      audio_b64:
        description: 'Base64 do áudio'
        required: true
      start:
        description: 'Início do áudio (segundos)'
        required: false
        default: '0'
      end:
        description: 'Fim do áudio (segundos)'
        required: false
        default: '0'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checar repositório
        uses: actions/checkout@v3

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Instalar dependências
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Executar geração de avatar
        id: generate
        run: |
          mkdir -p outputs
          python generate_avatar.py \
            --image_b64 "${{ github.event.inputs.image_b64 }}" \
            --audio_b64 "${{ github.event.inputs.audio_b64 }}" \
            --start ${{ github.event.inputs.start }} \
            --end ${{ github.event.inputs.end }} \
            --output outputs/avatar.mp4

      - name: Salvar artefato
        uses: actions/upload-artifact@v3
        with:
          name: avatar-video
          path: outputs/avatar.mp4
